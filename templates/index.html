{% extends "base.html" %}
{% block content %}

  <!-- Flash-Meldungen -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-list">
        {% for cat, msg in messages %}
          <div class="flash {{ cat }}">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <section class="hero">
    <h1>Dein {{ app_name }} üëã</h1>
    <p>
      Einnahmen/Ausgaben per Umschalter w√§hlen. Betrag bitte positiv eingeben
      (z. B. <code>2.100</code> oder <code>12,34</code>); das Vorzeichen wird automatisch gesetzt.
    </p>
  </section>

  <!-- Formular: Neuer Eintrag -->
  <section class="card">
    <h2>Neuer Eintrag</h2>
    <form class="form-grid" action="{{ url_for('add_entry_route') }}" method="post" novalidate>
      <label>
        <span>Datum</span>
        <input type="date" name="date" value="{{ today }}" required>
      </label>

      <label>
        <span>Kategorie</span>
        <select name="category" required>
          <option value="" disabled selected>Bitte w√§hlen‚Ä¶</option>
          {% for c in categories %}
            <option value="{{ c }}">{{ c }}</option>
          {% endfor %}
        </select>
      </label>

      <label class="full">
        <span>Art</span>
        <div class="type-toggle">
          <label><input type="radio" name="type" value="income"> Einnahme</label>
          <label><input type="radio" name="type" value="expense"> Ausgabe</label>
        </div>
      </label>

      <label>
        <span>Betrag (‚Ç¨)</span>
        <input type="text" name="amount" placeholder="z. B. 2.100 oder 12,34" inputmode="decimal" required>
      </label>

      <label class="full">
        <span>Notiz (optional)</span>
        <input type="text" name="note" placeholder="z. B. Wocheneinkauf">
      </label>

      <div class="actions">
        <button class="btn" type="submit">Speichern</button>
      </div>
    </form>

    <!-- Separates Formular: Alle Eintr√§ge l√∂schen -->
    <form action="{{ url_for('clear_entries') }}" method="post" style="margin-top:12px;">
      <button class="btn btn-ghost" type="submit">Alle Eintr√§ge l√∂schen</button>
    </form>
  </section>

  <!-- √úbersicht -->
  <section class="card">
    <h2>√úbersicht</h2>
    <div class="summary">
      <div><strong>Einnahmen:</strong> {{ total_income|euro }} ‚Ç¨</div>
      <div><strong>Ausgaben:</strong> {{ total_expense|euro }} ‚Ç¨</div>
      <div><strong>Saldo:</strong> {{ balance|euro }} ‚Ç¨</div>
    </div>

    {% if entries and entries|length > 0 %}
      <div class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th>Datum</th>
              <th>Kategorie</th>
              <th class="right">Betrag</th>
              <th>Notiz</th>
              <th>Aktionen</th>
            </tr>
          </thead>
          <tbody>
            {% for e in entries %}
              <tr>
                <td>{{ e.date }}</td>
                <td>{{ e.category }}</td>
                <td class="right {{ 'neg' if e.amount < 0 else 'pos' }}">
                  {{ e.amount|euro }} ‚Ç¨
                </td>
                <td>{{ e.note }}</td>
                <td class="actions">
                  <a class="btn btn-small" href="{{ url_for('edit_entry', entry_id=e.id) }}">‚úè Bearbeiten</a>
                  <form action="{{ url_for('delete_entry_route', entry_id=e.id) }}" method="post" style="display:inline;" onsubmit="return confirm('Diesen Eintrag wirklich l√∂schen?');">
                    <button class="btn btn-small btn-ghost" type="submit">üóë L√∂schen</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="muted">Noch keine Eintr√§ge vorhanden.</p>
    {% endif %}
  </section>

{% endblock %}
